# CentOS 7 Security Hardening Tool Test Environment  
FROM centos:7

# Install system dependencies
RUN yum update -y && yum install -y \
    python3 \
    python3-pip \
    python3-devel \
    sudo \
    openssh-server \
    firewalld \
    audit \
    pam \
    rsyslog \
    systemd \
    curl \
    git \
    vim \
    epel-release \
    && yum clean all

# Create test user
RUN useradd -m -s /bin/bash testuser && \
    echo "testpass123" | passwd testuser --stdin && \
    usermod -aG wheel testuser

# Setup SSH
RUN ssh-keygen -A && \
    systemctl enable sshd

# Setup systemd and firewall
RUN systemctl enable firewalld && \
    systemctl enable auditd

# Create workspace directory
WORKDIR /workspace

# Copy Python requirements and install
COPY pyproject.toml ./
RUN python3 -m pip install --upgrade pip

# Expose SSH port for testing
EXPOSE 22

# Default command
CMD ["/usr/sbin/init"]